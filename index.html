<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Expense Tracker</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#A57D65"/>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js" defer></script>
</head>
<body>
    <!-- Preloader untuk loading awal halaman -->
    <div id="preloader">
        <div class="preloader-spinner"></div>
    </div>

    <canvas id="bg-animation"></canvas>

    <!-- Navigasi Utama -->
    <nav class="main-nav">
        <a href="#" id="nav-expense-tracker" class="active">Pelacak Pengeluaran</a>
        <a href="#" id="nav-data-analyzer">Asisten Analis Data</a>
    </nav>

    <!-- Kontainer untuk Pelacak Pengeluaran -->
    <div id="expense-tracker-page" class="page-container">
        <div class="container">
            <h1 class="text-3xl font-bold text-center mb-6">Pelacak Pengeluaran Harian</h1>

            <form id="expenseForm">
                <div class="form-group">
                    <label for="tanggal">Tanggal:</label>
                    <input type="date" id="tanggal" name="tanggal" required>
                </div>
                
                <div class="form-group">
                    <label for="deskripsi">Deskripsi:</label>
                    <input type="text" id="deskripsi" name="deskripsi" placeholder="Contoh: Beli Kopi 15000, Roti 10000" required>
                </div>
                
                <button type="button" id="detectItemsBtn" class="btn-api">✨ Deteksi Item</button>
                <div class="form-group">
                    <label for="kategori">Kategori:</label>
                    <select id="kategori" name="kategori" required>
                        <option value="">-- Pilih Kategori --</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Transportasi">Transportasi</option>
                        <option value="Belanja">Belanja</option>
                        <option value="Hiburan">Hiburan</option>
                        <option value="Tagihan">Tagihan</option>
                        <option value="Lain-lain">Lain-lain</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="jumlah">Jumlah (Rp):</label>
                    <input type="number" id="jumlah" name="jumlah" min="0" step="100" placeholder="Rp" required>
                </div>

                <button type="submit" class="btn-submit">Simpan Pengeluaran</button>
            </form>

            <!-- Kontainer untuk Chart -->
            <div id="chartContainer" class="chart-container hidden">
                <canvas id="expenseChart"></canvas>
            </div>

            <button type="button" id="analyzeExpensesBtn" class="btn-api mt-6">✨ Analisis Pengeluaran</button>

            <!-- Bagian Baru untuk Link Sinkronisasi -->
            <div id="syncSection" class="summary mt-4 hidden">
                <h2 class="text-lg font-semibold mb-2">Sinkronkan ke Perangkat Lain</h2>
                <p class="text-sm mb-3">Buka link di bawah ini pada perangkat lain untuk melihat data yang sama.</p>
                <!-- Tempat untuk menampilkan QR Code -->
                <div class="qr-container">
                    <canvas id="qrCodeCanvas"></canvas>
                </div>
                <label for="syncLinkInput">Link Sinkronisasi Anda:</label>
                <input type="text" id="syncLinkInput" readonly 
                       style="cursor: copy; background-color: rgba(0,0,0,0.05); margin-top: 0.5rem;" 
                       onclick="this.select(); document.execCommand('copy'); alert('Link disalin!');">
            </div>

            <div class="summary mt-8 rounded-lg">
                <h2 class="text-xl font-semibold mb-3">Ringkasan Pengeluaran</h2>
                <div id="summaryContent" class="space-y-2">
                    <!-- Ringkasan pengeluaran harian akan ditampilkan di sini -->
                </div>
            </div>

            <div id="expenseList" class="mt-6">
                <!-- Daftar transaksi akan ditampilkan di sini -->
            </div>

            <div id="message" class="message hidden"></div>
            <div id="apiMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- Kontainer untuk Asisten Analis Data -->
    <div id="data-analyzer-page" class="page-container hidden">
        <div class="container">
            <h1 class="text-3xl font-bold text-center mb-6">Asisten Analis Data</h1>
            <div class="form-group">
                <label for="csvFileInput">1. Unggah File Data (.csv)</label>
                <input type="file" id="csvFileInput" accept=".csv" class="file-input">
            </div>

            <div id="dataSummaryContainer" class="summary mt-4 hidden">
                <h2 class="text-xl font-semibold mb-3">Ringkasan Data Awal</h2>
                <div id="dataSummaryLoader" class="loader hidden"></div>
                <pre id="dataSummaryContent"></pre>
            </div>

            <div class="form-group">
                <label for="analysisPrompt">2. Tulis Perintah Analisis Anda</label>
                <textarea id="analysisPrompt" rows="4" placeholder="Contoh: Lakukan analisis regresi linear untuk memprediksi 'penjualan' berdasarkan 'iklan'. Berikan juga ringkasan statistik deskriptif untuk semua kolom."></textarea>
            </div>
            <button id="runAnalysisBtn" class="btn-submit">Jalankan Analisis</button>

            <div id="analysisResultContainer" class="summary mt-6 hidden">
                <h2 class="text-xl font-semibold mb-3">Hasil Analisis AI</h2>
                <div id="analysisLoader" class="loader hidden"></div>
                <pre id="analysisResultContent"></pre>
            </div>
        </div>
    </div>


    <!-- Modal untuk Menampilkan Hasil Deteksi -->
    <div id="detectionModal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Item yang Dideteksi</h2>
            <div id="detectedItemsList" class="space-y-4">
                <!-- Daftar item dari Gemini API akan muncul di sini -->
            </div>
            <button id="confirmItemsBtn" class="btn-submit mt-6">Simpan sebagai Transaksi</button>
            <button id="cancelModalBtn" class="btn-api mt-4">Batalkan</button>
        </div>
    </div>
    <script>
      // PASTE KONFIGURASI FIREBASE ANDA DI SINI
      // Ganti objek di bawah ini dengan konfigurasi yang Anda dapatkan dari Firebase Console
      const firebaseConfigObject = {
        apiKey: "AIzaSyD_33r5f_4M7aX0XuyhRIFGoyPESfjGnUI",
        authDomain: "expenses-a36ff.firebaseapp.com",
        projectId: "expenses-a36ff",
        storageBucket: "expenses-a36ff.firebasestorage.app",
        messagingSenderId: "306521276424",
        appId: "1:306521276424:web:654020afbefbbd4d8311bd",
        measurementId: "G-1NSLPX2568"
      };
      // Mengubah objek menjadi string JSON untuk digunakan di script.js
      const __firebase_config = JSON.stringify(firebaseConfigObject);
    </script>
    <script src="script.js" defer></script>
    <script>
        // --- PWA Service Worker Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('ServiceWorker registrasi berhasil: ', registration))
                    .catch(err => console.log('ServiceWorker registrasi gagal: ', err));
            });
        }
    </script>
</body>
</html>
